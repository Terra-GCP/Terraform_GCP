---
  steps:
    - id: 'policy-check'
      name: 'alpine:3.13.3'
      dir: 'modules-disks-wise/'
      entrypoint: 'sh'
      args:
        - '-c'
        - |
            apk add git bash curl
              curl https://releases.hashicorp.com/terraform/${TERRAFORM_VERSION}/terraform_${TERRAFORM_VERSION}_linux_amd64.zip -o terraform_${TERRAFORM_VERSION}_linux_amd64.zip && \
              unzip terraform_${TERRAFORM_VERSION}_linux_amd64.zip && \
              terraform plan -out tf.plan
              terraform show -json tf.plan > tfplan.json
              terraform validate .
              curl -L -o opa https://github.com/open-policy-agent/opa/releases/download/v0.11.0/opa_linux_amd64
              chmod 755 opa
              opa eval --format pretty --data policy_all.rego --input tfplan.json "data.terraform"
  